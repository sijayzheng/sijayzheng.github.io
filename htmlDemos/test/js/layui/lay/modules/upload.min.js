layui.define("layer",function(a){"use strict";var b=layui.$,c=layui.layer,d=layui.hint(),e=layui.device(),f={config:{},set:function(a){var c=this;return console.log(c),c.config=b.extend({},c.config,a),c},on:function(a,b){return layui.onevent.call(this,"upload",a,b)}},g=function(){var a=this;return{upload:function(b){a.upload.call(a,b)},reload:function(b){a.reload.call(a,b)},config:a.config}},h=function(a){var c=this;c.config=b.extend({},c.config,f.config,a),c.render()};h.prototype.config={accept:"images",exts:"",auto:!0,bindAction:"",url:"",field:"file",acceptMime:"",method:"post",data:{},drag:!0,size:0,number:0,multiple:!1,before:function(){return!0}},h.prototype.render=function(a){var c=this,a=c.config;a.elem=b(a.elem),a.bindAction=b(a.bindAction),c.file(),c.events()},h.prototype.file=function(){var a=this,c=a.config,d=a.elemFile=b(["<input class=\"layui-upload-file\" type=\"file\" accept=\""+c.acceptMime+"\" name=\""+c.field+"\"",c.multiple?" multiple":"",">"].join("")),f=c.elem.next();(f.hasClass("layui-upload-file")||f.hasClass("layui-upload-form"))&&f.remove(),e.ie&&10>e.ie&&c.elem.wrap("<div class=\"layui-upload-wrap\"></div>"),a.isFile()?(a.elemFile=c.elem,c.field=c.elem[0].name):c.elem.after(d),e.ie&&10>e.ie&&a.initIE()},h.prototype.initIE=function(){var a=this,c=a.config,d=b("<iframe id=\"layui-upload-iframe\" class=\"layui-upload-iframe\" name=\"layui-upload-iframe\" frameborder=\"0\"></iframe>"),e=b(["<form target=\"layui-upload-iframe\" class=\"layui-upload-form\" method=\"post\" key=\"set-mine\" enctype=\"multipart/form-data\" action=\""+c.url+"\">","</form>"].join(""));b("#layui-upload-iframe")[0]||b("body").append(d),c.elem.next().hasClass("layui-upload-form")||(a.elemFile.wrap(e),c.elem.next(".layui-upload-form").append(function(){var a=[];return layui.each(c.data,function(b,c){c="function"==typeof c?c():c,a.push("<input type=\"hidden\" name=\""+b+"\" value=\""+c+"\">")}),a.join("")}()))},h.prototype.msg=function(a){return c.msg(a,{icon:2,shift:6})},h.prototype.isFile=function(){var a=this.config.elem[0];return a?"input"===a.tagName.toLocaleLowerCase()&&"file"===a.type:void 0},h.prototype.preview=function(a){var b=this;window.FileReader&&layui.each(b.chooseFiles,function(b,c){var d=new FileReader;d.readAsDataURL(c),d.onload=function(){a&&a(b,c,this.result)}})},h.prototype.upload=function(a,c){var d,f=this,g=f.config,i=f.elemFile[0],j=function(){var c=0,d=0,e=a||f.files||f.chooseFiles||i.files,h=function(){g.multiple&&c+d===f.fileLength&&"function"==typeof g.allDone&&g.allDone({total:f.fileLength,successful:c,aborted:d})};layui.each(e,function(a,e){var i=new FormData;i.append(g.field,e),layui.each(g.data,function(a,b){b="function"==typeof b?b():b,i.append(a,b)});var j={url:g.url,type:"post",data:i,contentType:!1,processData:!1,dataType:"json",headers:g.headers||{},success:function(b){c++,l(a,b),h()},error:function(){d++,f.msg("\u8BF7\u6C42\u4E0A\u4F20\u63A5\u53E3\u51FA\u73B0\u5F02\u5E38"),m(a),h()}};"function"==typeof g.progress&&(j.xhr=function(){var a=b.ajaxSettings.xhr();return a.upload.addEventListener("progress",function(a){if(a.lengthComputable){var b=Math.floor(100*(a.loaded/a.total));g.progress(b,g.item[0],a)}}),a}),b.ajax(j)})},k=function(){var a=b("#layui-upload-iframe");f.elemFile.parent().submit(),clearInterval(h.timer),h.timer=setInterval(function(){var b,c=a.contents().find("body");try{b=c.text()}catch(a){f.msg("\u83B7\u53D6\u4E0A\u4F20\u540E\u7684\u54CD\u5E94\u4FE1\u606F\u51FA\u73B0\u5F02\u5E38"),clearInterval(h.timer),m()}b&&(clearInterval(h.timer),c.html(""),l(0,b))},30)},l=function(a,b){if(f.elemFile.next(".layui-upload-choose").remove(),i.value="","object"!=typeof b)try{b=JSON.parse(b)}catch(a){return b={},f.msg("\u8BF7\u5BF9\u4E0A\u4F20\u63A5\u53E3\u8FD4\u56DE\u6709\u6548JSON")}"function"==typeof g.done&&g.done(b,a||0,function(a){f.upload(a)})},m=function(a){g.auto&&(i.value=""),"function"==typeof g.error&&g.error(a||0,function(a){f.upload(a)})},n=g.exts,o=function(){var b=[];return layui.each(a||f.chooseFiles,function(a,c){b.push(c.name)}),b}(),p={preview:function(a){f.preview(a)},upload:function(a,b){var c={};c[a]=b,f.upload(c)},pushFile:function(){return f.files=f.files||{},layui.each(f.chooseFiles,function(a,b){f.files[a]=b}),f.files},resetFile:function(a,b,c){var d=new File([b],c);f.files=f.files||{},f.files[a]=d}},q=function(){if(!(("choose"===c||g.auto)&&(g.choose&&g.choose(p),"choose"===c)))if(g.before&&g.before(p),g.before(p)){if(e.ie)return 9<e.ie?j():k();j()}else return};if(o=0===o.length?i.value.match(/[^\/\\]+\..+/g)||[]||"":o,0!==o.length){switch(g.accept){case"file":if(n&&!RegExp("\\w\\.("+n+")$","i").test(escape(o)))return f.msg("\u9009\u62E9\u7684\u6587\u4EF6\u4E2D\u5305\u542B\u4E0D\u652F\u6301\u7684\u683C\u5F0F"),i.value="";break;case"video":if(!RegExp("\\w\\.("+(n||"avi|mp4|wma|rmvb|rm|flash|3gp|flv")+")$","i").test(escape(o)))return f.msg("\u9009\u62E9\u7684\u89C6\u9891\u4E2D\u5305\u542B\u4E0D\u652F\u6301\u7684\u683C\u5F0F"),i.value="";break;case"audio":if(!RegExp("\\w\\.("+(n||"mp3|wav|mid")+")$","i").test(escape(o)))return f.msg("\u9009\u62E9\u7684\u97F3\u9891\u4E2D\u5305\u542B\u4E0D\u652F\u6301\u7684\u683C\u5F0F"),i.value="";break;default:if(layui.each(o,function(a,b){RegExp("\\w\\.("+(n||"jpg|png|gif|bmp|jpeg$")+")","i").test(escape(b))||(d=!0)}),d)return f.msg("\u9009\u62E9\u7684\u56FE\u7247\u4E2D\u5305\u542B\u4E0D\u652F\u6301\u7684\u683C\u5F0F"),i.value="";}if(f.fileLength=function(){var b=0,c=a||f.files||f.chooseFiles||i.files;return layui.each(c,function(){b++}),b}(),g.number&&f.fileLength>g.number)return f.msg("\u540C\u65F6\u6700\u591A\u53EA\u80FD\u4E0A\u4F20\u7684\u6570\u91CF\u4E3A\uFF1A"+g.number);if(0<g.size&&!(e.ie&&10>e.ie)){var r;if(layui.each(f.chooseFiles,function(a,b){if(b.size>1024*g.size){var c=g.size/1024;c=1<=c?c.toFixed(2)+"MB":g.size+"KB",i.value="",r=c}}),r)return f.msg("\u6587\u4EF6\u4E0D\u80FD\u8D85\u8FC7"+r)}q()}},h.prototype.reload=function(a){a=a||{},delete a.elem,delete a.bindAction;var c=this,a=c.config=b.extend({},c.config,f.config,a),d=a.elem.next();d.attr({name:a.name,accept:a.acceptMime,multiple:a.multiple})},h.prototype.events=function(){var a=this,c=a.config,f=function(b){a.chooseFiles={},layui.each(b,function(b,c){var d=new Date().getTime();a.chooseFiles[d+"-"+b]=c})},g=function(b){var d=a.elemFile,e=1<b.length?b.length+"\u4E2A\u6587\u4EF6":(b[0]||{}).name||d[0].value.match(/[^\/\\]+\..+/g)||[]||"";d.next().hasClass("layui-upload-choose")&&d.next().remove(),a.upload(null,"choose");a.isFile()||c.choose||d.after("<span class=\"layui-inline layui-upload-choose\">"+e+"</span>")};c.elem.off("upload.start").on("upload.start",function(){var e=b(this),f=e.attr("lay-data");if(f)try{f=new Function("return "+f)(),a.config=b.extend({},c,f)}catch(a){d.error("Upload element property lay-data configuration item has a syntax error: "+f)}a.config.item=e,a.elemFile[0].click()}),e.ie&&10>e.ie||c.elem.off("upload.over").on("upload.over",function(){var a=b(this);a.attr("lay-over","")}).off("upload.leave").on("upload.leave",function(){var a=b(this);a.removeAttr("lay-over")}).off("upload.drop").on("upload.drop",function(d,e){var h=b(this),i=e.originalEvent.dataTransfer.files||[];h.removeAttr("lay-over"),f(i),c.auto?a.upload(i):g(i)}),a.elemFile.off("upload.change").on("upload.change",function(){var b=this.files||[];f(b),c.auto?a.upload():g(b)}),c.bindAction.off("upload.action").on("upload.action",function(){a.upload()});c.elem.data("haveEvents")||(a.elemFile.on("change",function(){b(this).trigger("upload.change")}),c.elem.on("click",function(){a.isFile()||b(this).trigger("upload.start")}),c.drag&&c.elem.on("dragover",function(a){a.preventDefault(),b(this).trigger("upload.over")}).on("dragleave",function(){b(this).trigger("upload.leave")}).on("drop",function(a){a.preventDefault(),b(this).trigger("upload.drop",a)}),c.bindAction.on("click",function(){b(this).trigger("upload.action")}),c.elem.data("haveEvents",!0))},f.render=function(a){var b=new h(a);return g.call(b)},a("upload",f)});